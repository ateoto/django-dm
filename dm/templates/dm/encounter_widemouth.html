{% extends "dm/base.html" %}
{% load staticfiles %}
{% block css %}
{{ block.super }}
        <link href="{% static "dm/css/encounter-wm.css" %}" rel="stylesheet">
{% endblock css %}

{% block js %}
{{ block.super }}
        <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
        <script src="{% static "dm/js/handlebars-1.0.rc.1.min.js" %}"></script>
        <script src="{% static "dm/js/encounter.js" %}"></script>
        <script src="{% static "dm/js/npc.js" %}"></script>
        <script src="{% static "dm/js/party.js" %}"></script>
        <script src="{% static "dm/js/character.js" %}"></script>
        <script src="{% static "dm/js/encounter-dm.js" %}"></script>

        {% verbatim %}
        <script id="npc-template" type="text/x-handlebars-template">
            <div class="npc-header">
                <div class="npc-name-line clearfix">
                    <span class="npc-name pull-left">{{ name }}</span>
                    <span class="npc-level pull-right">Level {{ level }} {{ role }}</span>
                </div>
                <div class="npc-origin-line clearfix">
                    <span class="npc-origin pull-left">Size origin type</span>
                    <span class="npc-xp-reward pull-right">XP {{ xp_reward }}</span>
                </div>
                <div class="npc-senses-line clearfix">
                    <span class="npc-initiative pull-left"><strong>Initiative</strong> {{ initiative }}</span>
                    <span class="npc-senses pull-right"><strong>Senses </strong>Perception {{ perception }}</span>
                </div>
                <div class="npc-health-line clearfix">
                    <strong>HP</strong> {{ hit_points }}
                    {{#if bloodied}}; <strong>Bloodied</strong> {{ bloodied }} {{/if}}
                </div>
                <div class="npc-defense-line">
                    <strong>AC</strong> {{ defenses.ac.total }}; 
                    <strong>Fortitude</strong> {{ defenses.fort.total }}, 
                    <strong>Reflex</strong> {{ defenses.ref.total }}, 
                    <strong>Will</strong> {{ defenses.will.total }}
                </div>
                <div class="npc-speed-line">
                    <strong>Speed</strong> {{ speed }}
                </div>
            {{#each powers }}
            <div class="npc-power">
                <strong>{{ this.name }}</strong> {{ this.action_line }} {{#if this.keywords}}* <strong>{{ this.keywords }}</strong>{{/if}}<br>
                {{ this.description }}
            </div>
            {{/each}}

                <div id="npc-detail-stats-abilities">
                    <div class="row">
                        <div id="npc-detail-str" class="span2">
                            <span class="npc-detail-ability-label"><strong>Str</strong> </span>
                            <span class="npc-detail-ability-check">{{ abilities.str.score }} ({{ abilities.str.check }})</span> 
                        </div>
                        <div id="npc-detail-dex" class="span2">
                            <span class="npc-detail-ability-label"><strong>Dex</strong> </span>
                            <span class="npc-detail-ability-check">{{ abilities.dex.score }} ({{ abilities.dex.check }})</span> 
                        </div>
                        <div id="npc-detail-wis" class="span2">
                            <span class="npc-detail-ability-label"><strong>Wis</strong> </span>
                            <span class="npc-detail-ability-check">{{ abilities.wis.score }} ({{ abilities.wis.check }})</span> 
                        </div>
                    </div>
                    <div class="row">
                        <div id="npc-detail-con" class="span2">
                            <span class="npc-detail-ability-label"><strong>Con</strong> </span>
                            <span class="npc-detail-ability-check">{{ abilities.con.score }} ({{ abilities.con.check }})</span> 
                        </div>
                        <div id="npc-detail-int" class="span2">
                            <span class="npc-detail-ability-label"><strong>Int</strong> </span>
                            <span class="npc-detail-ability-check">{{ abilities.int.score }} ({{ abilities.int.check }})</span> 
                        </div>
                        <div id="npc-detail-cha" class="span2">
                            <span class="npc-detail-ability-label"><strong>Cha</strong> </span>
                            <span class="npc-detail-ability-check">{{ abilities.cha.score }} ({{ abilities.cha.check }})</span> 
                        </div>
                    </div>
                </div>
        </script>
        {% endverbatim %}
{% endblock %}



{% block content %}
<div id="encounter" encounter-id="{{ encounter.id }}">
    <div id="panel-1">
        <h3>Characters</h3>
        <table id="pc-overview" class="table table-striped table-bordered table-condensed table-hover" party-id="{{ party.id }}">
            <thead>
                <tr>
                    <th>Initiative</th>
                    <th>Name</th>
                    <th>Health</th>
                    <th>Group</th>
                </tr>
            </thead>
            <tbody>
                {% for c in party.characters.all %}
                <tr id="pc-{{ c.id }}" class="pc-character-overview" pc-id="{{ c.id }}">
                    <td id="pc-init-{{ c.id }}">{{ c.get_abilities.dex.modifier_half_level }}</td>
                    <td id="pc-name-{{ c.id }}">{{ c.name }}</td>
                    <td id="pc-health-{{ c.id }}">
                        <span id="hp-text-{{ c.id }}">{{ c.hit_points }}</span>
                        /
                        <span id="max-hp-text-{{ c.id }}">{{ c.max_hit_points }}</span>
                    </td>
                    <td class="pc-group-command-container">
                        <input id="pc-group-{{ c.id }}" class="pc-group-command" type="checkbox">
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div id="group-commands">
            <h3>PC Commands</h3>
                <div class="input-append">
              <input class="span2" id="pc-group-damage" type="text" placeholder="Damage">
              <button id="pc-group-damage-btn" class="btn" type="button" tabindex="-1">Damage</button>
            </div>
            <div class="input-append">
              <input class="span2" id="pc-group-heal" type="text" placeholder="Heal">
              <button id="pc-group-heal-btn" class="btn" type="button" tabindex="-1">Heal</button>
            </div>
            <div class="input-append">
              <input class="span2" id="pc-group-xp" type="text" placeholder="XP">
              <button id="pc-group-xp" class="btn" type="button" tabindex="-1">Give XP</button>
            </div>
            <div class="input-append">
                <select class="span1">
                    <option>cp</option>
                    <option>sp</option>
                    <option>gp</option>
                </select>
                <input class="span1" id="pc-group-currency" type="text" placeholder="Amount">
                <button class="btn" id="pc-group-currency" type="button" tabindex="-1">Give Money</button>
            </div>
        </div>
        <h3>NPCs</h3>
        <table id="npc-overview" class="table table-striped table-bordered table-condensed table-hover" encounter-id="{{ encounter.id }}">
            <thead>
                <tr>
                    <th>Initiative</th>
                    <th>Symbol</th>
                    <th>Name</th>
                    <th>Health</th>
                </tr>
            </thead>
            <tbody>
                {% for npc in encounter.npcs.all.select_subclasses %}
                <tr id="npc-{{ npc.id }}" class="npc-overview" npc-id="{{ npc.id }}">
                    <td id="npc-init-{{ npc.id }}"> {{ npc.get_abilities.dex.modifier_half_level }}</td>
                    <td id="npc-symbol-{{ npc.id }}"></td>
                    <td id="npc-name-{{ npc.id }}">{{ npc.npc_type.name }}</td>
                    <td id="npc-health-{{ npc.id }}">
                        <span id="npc-hp-text-{{ npc.id }}">{{ npc.hit_points }}</span>
                        /
                        <span id="npc-max-hp-text-{{ npc.id }}">{{ npc.npc_type.max_hit_points }}</span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- ************************** DETAIL ******************************** -->
    <div id="panel-2">
        <div id="pc-detail">
            <h3>
                <span id="pc-detail-name"></span>
                <small>Level <span id="pc-detail-level-text"></span> <span id="pc-detail-flavor"></span></small>
            </h3>
            <div id="pc-detail-toolbar" class="btn-group" data-toggle="buttons-radio">
                <button id="pc-stats-btn" class="btn active" title="Stats">Stats</button>
                <button id="pc-powers-btn" class="btn" title="Powers">Powers</button>
                <button id="pc-feats-btn" class="btn" title="Feats">Feats</button>
                <button id="pc-equipment-btn" class="btn" title="Equipment">Equipment</button>
                <button id="pc-dm-btn" class="btn" title="Dungeon Master">DM</button>
            </div>
            <div id="pc-detail-stats" class="pc-detail-body">
                <div id="pc-detail-stats-defenses">
                    <div class="row">
                        <div id="pc-detail-ac" class="span6">
                            <span class="pc-detail-defense-label">AC: </span>
                            <span class="pc-detail-defense-value"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div id="pc-detail-fort" class="span2">
                            <span class="pc-detail-defense-label">Fortitude: </span>
                            <span class="pc-detail-defense-value"></span>
                        </div>
                        <div id="pc-detail-ref" class="span2">
                            <span class="pc-detail-defense-label">Reflex: </span>
                            <span class="pc-detail-defense-value"></span>
                        </div>
                        <div id="pc-detail-will" class="span2">
                            <span class="pc-detail-defense-label">Will: </span>
                            <span class="pc-detail-defense-value"></span>
                        </div>
                    </div>
                </div>
                <div id="pc-detail-stats-abilities">
                    <div class="row">
                        <div id="pc-detail-str" class="span2">
                            <span class="pc-detail-ability-label">Str: </span>
                            <span class="pc-detail-ability-check"></span> 
                        </div>
                        <div id="pc-detail-dex" class="span2">
                            <span class="pc-detail-ability-label">Dex: </span>
                            <span class="pc-detail-ability-check"></span> 
                        </div>
                        <div id="pc-detail-wis" class="span2">
                            <span class="pc-detail-ability-label">Wis: </span>
                            <span class="pc-detail-ability-check"></span> 
                        </div>
                    </div>
                    <div class="row">
                        <div id="pc-detail-con" class="span2">
                            <span class="pc-detail-ability-label">Con: </span>
                            <span class="pc-detail-ability-check"></span> 
                        </div>
                        <div id="pc-detail-int" class="span2">
                            <span class="pc-detail-ability-label">Int: </span>
                            <span class="pc-detail-ability-check"></span> 
                        </div>
                        <div id="pc-detail-cha" class="span2">
                            <span class="pc-detail-ability-label">Cha: </span>
                            <span class="pc-detail-ability-check"></span> 
                        </div>
                    </div>
                </div>
            </div>
            <div id="pc-detail-dm" class="pc-detail-body">
                <div class="input-append">
                  <input class="span2" id="pc-damage" type="text" placeholder="Damage">
                  <button id="pc-damage-btn" class="btn" type="button" tabindex="-1">Damage</button>
                </div>
                <div class="input-append">
                  <input class="span2" id="pc-heal" type="text" placeholder="Heal">
                  <button id="pc-heal-btn" class="btn" type="button" tabindex="-1">Heal</button>
                </div>
                <div class="input-append">
                  <input class="span2" id="pc-init" type="text" placeholder="Initiative">
                  <button class="btn" id="pc-init-btn" type="button" tabindex="-1">Set</button>
                </div>
            </div>
        </div>
    </div>
    <div id="panel-3">
        <div id="npc-detail">
            <h3>
                <span id="npc-detail-name"></span>
                <small>Level <span id="npc-detail-level-text"></span> <span id="npc-detail-flavor"></span></small>
            </h3>
            <div id="npc-detail-toolbar" class="btn-group" data-toggle="buttons-radio">
                <button id="npc-stats-btn" class="btn active" title="Stats">Stats</button>
                <button id="npc-powers-btn" class="btn" title="Powers">Powers</button>
                <button id="npc-feats-btn" class="btn" title="Feats">Feats</button>
                <button id="npc-equipment-btn" class="btn" title="Equipment">Equipment</button>
                <button id="npc-dm-btn" class="btn" title="Dungeon Master">DM</button>
            </div>
            <div id="npc-detail-body-container"></div>
            <div id="npc-detail-dm" class="npc-detail-body">
                <div class="input-append">
                  <input class="span2" id="npc-damage" type="text" placeholder="Damage">
                  <button id="npc-damage-btn" class="btn" type="button" tabindex="-1">Damage</button>
                </div>
                <div class="input-append">
                  <input class="span2" id="npc-heal" type="text" placeholder="Heal">
                  <button id="npc-heal-btn" class="btn" type="button" tabindex="-1">Heal</button>
                </div>
                <div class="input-append">
                  <input class="span2" id="npc-init" type="text" placeholder="Initiative">
                  <button class="btn" id="npc-init-btn" type="button" tabindex="-1">Set Initiative</button>
                </div>
                <div class="input-append">
                    <input class="span2" id="npc-symbol" type="text" placeholder="Symbol">
                    <button class="btn" id="npc-symbol-btn" type="button" tabindex="-1">Set Symbol</button>
                </div>
                <button class="btn" id="npc-remove-btn" type="button" tabindex="-1">Remove</button>
            </div>
        </div>
    </div>
    <div id="panel-4">
        <div id="history">
            <h3>History</h3>
        </div>
    </div>
</div>
{% csrf_token %}
{% endblock %}